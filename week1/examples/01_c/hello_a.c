//
// "Hello, world" geek-style
//
// Will only work with x86-64 Linux and gcc: gcc -w -o hello_a hello_a.c
//
// Useful links:
// https://gcc.gnu.org/legacy-ml/gcc-help/2010-09/msg00088.html
// https://stackoverflow.com/questions/58455300/assembler-warning-with-gcc-warning-when-placing-data-in-text
//
//  (c) Alexei Guirik, 2021
//  This source is licensed under CC BY-NC 4.0 (https://creativecommons.org/licenses/by-nc/4.0/)
//  
__attribute__((section(".text#")))
extern const unsigned char main[] = {
    0x55,                                                       // push   rbp
    0x48, 0x89, 0xe5,                                           // mov    rbp,rsp
    0x48, 0x83, 0xec, 0x30,                                     // sub    rsp,0x30
    0x48, 0xb8, 0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c, 0x20, 0x75, // movabs rax,0x75202c6f6c6c6548
    0x48, 0xba, 0x67, 0x6c, 0x79, 0x20, 0x61, 0x6e, 0x64, 0x20, // movabs rdx,0x20646e6120796c67 
    0x48, 0x89, 0x45, 0xd0,                                     // mov    QWORD PTR [rbp-0x30],rax
    0x48, 0x89, 0x55, 0xd8,                                     // mov    QWORD PTR [rbp-0x28],rdx
    0x48, 0xb8, 0x75, 0x6e, 0x66, 0x6f, 0x72, 0x67, 0x69, 0x76, // movabs rax,0x766967726f666e75 
    0x48, 0xba, 0x69, 0x6e, 0x67, 0x20, 0x77, 0x6f, 0x72, 0x6c, // movabs rdx,0x6c726f7720676e69 
    0x48, 0x89, 0x45, 0xe0,                                     // mov    QWORD PTR [rbp-0x20],rax
    0x48, 0x89, 0x55, 0xe8,                                     // mov    QWORD PTR [rbp-0x18],rdx
    0xc7, 0x45, 0xf0, 0x64, 0x21, 0x0a, 0x00,                   // mov    DWORD PTR [rbp-0x10],0xa2164
    0x48, 0x8d, 0x75, 0xd0,                                     // lea    rsi,[rbp-0x30]
    0xb8, 0x01, 0x00, 0x00, 0x00,                               // mov    eax,0x1
    0xbf, 0x01, 0x00, 0x00, 0x00,                               // mov    edi,0x1
    0xba, 0x23, 0x00, 0x00, 0x00,                               // mov    edx,0x23
    0x0f, 0x05,                                                 // syscall (write)
    0xb8, 0x3c, 0x00, 0x00, 0x00,                               // mov    eax,0x3c
    0xbf, 0x2a, 0x00, 0x00, 0x00,                               // mov    edi,0x2a
    0x0f, 0x05,                                                 // syscall (exit)
};

